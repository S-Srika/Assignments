<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Update Password</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="./style.css">
    <!--FireBase SDK-->
    <script defer src="https://www.gstatic.com/firebasejs/8.10.1/firebase.js"></script>
    <script defer src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script defer src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
</head>

<body>
    <div class="2xl:container mx-auto bg-gradient-to-b from-[#3096dbfe] to-[#010f53] h-screen  ">
        <div class="w-[90%] mx-auto">
            <div class="flex flex-col justify-center items-center h-screen ">
                <form action="" id="updatePassword" class="bg-white/20 border-2 p-5 rounded-3xl md:p-7">
                    <div class="flex flex-col justify-center items-center gap-6">
                        <!-- h1 div  -->
                        <div class="text-[25px] md:text-[2rem]">
                            <h1 class="text-white">Update Password</h1>
                            <hr class="mt-2">
                        </div>
                        
                        <!-- input div  -->
                        <div class="flex flex-col gap-6 text-[13px] md:text-[16px] ">
                            <!-- new password div -->
                            <div class="flex flex-col gap-4">
                                <label for="newPassword" class="text-white">New Password</label>
                                <input
                                    class="py-2 rounded-2xl border-2 hover:border-[black] shadow-xl focus:outline-none focus:ring-0 px-4"
                                    type="text" name="new_password" id="newPassword" placeholder=" Create new password">
                                <p class="text-red-500 text-[14px]" id="newPasswordErr"></p>
                            </div>
                            <!-- confirm password div  -->
                            <div class="flex flex-col gap-4">
                                <label for="confirmPassword" class="text-white">Confirm Password</label>
                                <input
                                    class="py-2 rounded-2xl border-2 hover:border-[black] shadow-xl focus:outline-none focus:ring-0 px-4"
                                    type="text" name="confirm_password" id="confirmPassword"
                                    placeholder=" Confirm password">
                                <p class="text-red-500 text-[14px] " id="confirmPasswordErr"> </p>

                            </div>
                        </div>
                        <!-- button div  -->
                        <div>
                            <button id="updateBtn"
                                class="text-[14px] md:text-[18px] bg-blue-700 border-[#7e9ae8] border-2 py-2 px-7 rounded-3xl text-white  ">Update</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <script>
        var form = document.getElementById("updatePassword");
        var newPassword = document.getElementById("newPassword");
        var confirmPassword = document.getElementById("confirmPassword");
        var newPasswordErr = document.getElementById("newPasswordErr");
        var confirmPasswordErr = document.getElementById("confirmPasswordErr");
        var requiredConfirm = document.getElementById("requiredConfirm");

        form.addEventListener("submit", (e) => {
            e.preventDefault();
            // console.dir(newPassword);
            var isvalid = advancedValidation(newPassword.value, confirmPassword.value);
            if (isvalid) {
                saveData(newPassword.value, confirmPassword.value);
                console.log("Data is sended")
            }

        });


        function saveData(newPassword, confirmPassword) {
            // Your web app's Firebase configuration
            const firebaseConfig = {
                apiKey: "AIzaSyApPLK9YuAji3qkfMSJ3zsSwK_3dk9JSoI",
                authDomain: "updatepasproj.firebaseapp.com",
                databaseURL: "https://updatepasproj-default-rtdb.asia-southeast1.firebasedatabase.app",
                projectId: "updatepasproj",
                storageBucket: "updatepasproj.firebasestorage.app",
                messagingSenderId: "243144689916",
                appId: "1:243144689916:web:bef796aa98379e70fd2f79"
            };

            if (!firebase.apps.length) {
                firebase.initializeApp(firebaseConfig);
            }

            const db = firebase.database().ref("FormUpdate");

            db.push({
                NewPass: newPassword,
                confirmPass: confirmPassword,

            });

        }


        newPassword.addEventListener("input", (e) => {
            // console.log(e);
            //console.log(e.target.value);
            var passRegex = /^(?=.*?[A-Z])(?=.*?[a-z])(?=.*?[0-9])(?=.*?[#?!@$%^&*-]).{8,}$/;
            if (e.target.value == "") {
                newPasswordErr.textContent = "Required *";
            } else if (!e.target.value.match(passRegex)) {
                newPasswordErr.textContent = "Must in Abcd@123";
            } else {
                newPasswordErr.textContent = "";
            }
        });
        confirmPassword.addEventListener("input", (e) => {
            if (confirmPassword.value !== newPassword.value) {
                confirmPasswordErr.textContent = "Password is not same!";
            } else {
                confirmPasswordErr.textContent = "";
            }
        })
        function advancedValidation(newPass, confirmPass) {
            //console.log(newPass,confirmPass);
            var passRegex = /^(?=.*?[A-Z])(?=.*?[a-z])(?=.*?[0-9])(?=.*?[#?!@$%^&*-]).{8,}$/;
            var isvalid = false;
            if (!newPass.match(passRegex)) {
                console.log(`Invalid Password`);
                newPasswordErr.textContent = "Invalid email format Abcd@123";
            } else {
                newPasswordErr.textContent = "";
                isvalid = true;
            }
            // confirmPass
            if (newPass !== confirmPass) {
                confirmPasswordErr.textContent = "Password do not match!";
            } else {
                confirmPasswordErr.textContent = "";
                isvalid = true;
            }

            console.log(newPass, confirmPass);
            if (isvalid) {
                alert("Password Updated");
                setTimeout(() => {
                    form.reset();
                }, 1000);
            }
            return isvalid;
        }


        /**/
        /*    newPassword.addEventListener("input",(e)=>{
               if(e.target.value === ""){
                   newPasswordErr.textContent="Required *";
               }else{
                   newPasswordErr.textContent="";
               }
                  
               });
                */
        /*     confirmPassword.addEventListener("input", (e) => {
            if (e.target.value === "") {
                confirmPasswordErr.textContent = "Required *";
            } else if (e.target.value !== newPassword) {
                confirmPasswordErr.textContent = "Password do not match!";
            } else {
                confirmPasswordErr.textContent = "";
            }
        });*/

        /*  newPassword.addEventListener("blur",()=>{
              if(newPassword.value.trim() ===''){
                  newPasswordErr.classList.toggle("hidden");
              }else{
                  newPasswordErr.classList.add("hidden");
              }
          });
          confirmPassword.addEventListener("blur",()=>{
              if(newPassword.value.trim() !== confirmPassword.value.trim()){
                  confirmPasswordErr.classList.toggle("hidden");
              }else{
                  confirmPasswordErr.classList.add("hidden");
              }
              if(confirmPassword.value.trim()===''){
                 requiredConfirm.classList.remove("hidden");  
              }else{
                  requiredConfirm.classList.add("hidden");
              }
          });
          */

    </script>
</body>
;

</html>